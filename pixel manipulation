from PIL import Image
import numpy as np

def encrypt_decrypt_image(image_path, key):
    # Open the image
    image = Image.open(image_path)
    image_array = np.array(image)

    # Convert key to a numpy array
    key_array = np.frombuffer(key.encode(), dtype=np.uint8)
    
    # Resize key array to match image dimensions
    key_array = np.resize(key_array, image_array.shape)

    # Perform XOR operation
    encrypted_array = image_array ^ key_array

    # Convert back to image
    encrypted_image = Image.fromarray(encrypted_array)

    return encrypted_image

def save_image(image, output_path):
    image.save(output_path)

# Usage
key = "your-secret-key"
input_image_path = "input_image.png"
encrypted_image_path = "encrypted_image.png"
decrypted_image_path = "decrypted_image.png"

# Encrypt the image
encrypted_image = encrypt_decrypt_image(input_image_path, key)
save_image(encrypted_image, encrypted_image_path)

# Decrypt the image
decrypted_image = encrypt_decrypt_image(encrypted_image_path, key)
save_image(decrypted_image, decrypted_image_path)
